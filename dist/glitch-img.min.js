"use strict";function t(t){return null==t?[]:void 0!==t.length?Array.prototype.slice.call(t):[t]}function e(t,e){if(null!=t&&null!=e)if(t.complete)e(t,t.naturalWidth,t.naturalHeight);else{var n=t.src||t;if("string"!=typeof n)return;var i=new Image;i.onload=function(){e(t,i.naturalWidth,i.naturalHeight)},i.src=n}}function n(t,e){var n=Math.random()*(e||1);return Math.random()*(1-n)+t*n}var i="http://www.w3.org/2000/svg",l="http://www.w3.org/1999/xlink",r="http://www.w3.org/2000/xmlns/";function s(t,e,n){var i=void 0!==n?document.createElementNS(n,t):document.createElement(t);if(null!=e){var l=void 0,r=void 0;for(l in e)r=e[l],Array.isArray(r)?i.setAttributeNS(r[0]||null,l,r[1]):i.setAttribute(l,r)}return i}var a=function(t){return"string"==typeof t?t.split(/\s+/):t||[]};function o(t,e){return t.classList?t.classList.contains(e):!!(t.className.indexOf(e)>-1)}function h(t,e){var n=a(e);if(t.classList)t.classList.add.apply(t.classList,n);else{for(var i=t.className,l=0;l<n.length;l++)i.indexOf(n[l])<0&&(i+=" "+n[l]);t.className=i}}function u(t,e){var n=a(e);if(t.classList)t.classList.remove.apply(t.classList,n);else{for(var i=a(t.className),l="",r=0;r<i.length;r++)n.indexOf(i[r])<0&&(l+=" "+i[r]);t.className=l.substring(1)}}function c(t){if(null==t)return null;for(;t.firstChild;)t.removeChild(t.firstChild);return t}function d(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=s("svg",{"xmlns:xlink":[r,l],preserveAspectRatio:[null,"none"],viewBox:"0 0 "+t.width+" "+t.height,class:t.class},i),n=s("image",{"clip-path":"url(#"+t.id+")",href:[l,t.src],width:[null,"100%"],height:[null,"100%"]},i);return e.appendChild(n),e}function f(t,e){if(!t||!t.src||o(t,e.classes.image))return this.element=null;var n=e.hashId();this.element=t,this.width=t.naturalWidth||100,this.height=t.naturalHeight||100,this.defs=e,h(t,e.classes.image);var l=s("div",{class:e.classes.wrapper}),r=d({src:t.src,width:this.width,height:this.height,class:e.classes.clone,id:n});t.parentElement.insertBefore(l,t),l.appendChild(t),l.appendChild(r),this.clipPath=s("clipPath",{id:n},i),e.element.appendChild(this.clipPath),this.update()}function p(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:8,n=arguments[2],i=null!=t?t.length:0,l="number"==typeof n?n:Date.now(),r="",s=1,a=0;a<i;a++)l^=t.charCodeAt(a),l+=(l<<1)+(l<<4)+(l<<7)+(l<<8)+(l<<24);for(l>>>=0;r.length<e;)r+=(l*s++).toString(16);return r.substr(0,e)}f.prototype={destroy:function(){if(null!=this.element){u(this.element,this.defs.classes.image);var t=this.element.parentElement;t.parentElement.insertBefore(this.element,t),t.parentElement.removeChild(t),this.defs.element.removeChild(this.clipPath),this.element=null,this.clipPath=null,this.defs=null}return null},update:function(){if(null==this.element)return this;var t=.3*this.height,e=0,l=void 0,r=void 0;for(c(this.clipPath),r=document.createDocumentFragment();e<=this.height;)l=Math.round(n(.01)*t),e+=Math.round(n(.01)*t)+l,r.appendChild(s("rect",{x:[null,"0"],y:[null,e],height:[null,l],width:[null,this.width]},i));return this.clipPath.appendChild(r),this}};var m="data-glitch-img",v=function(t){return["."+t.wrapper+"{\n        position: relative;\n        overflow: hidden;\n        display: inline-block;\n        vertical-align: top;\n    }","."+t.image+"{\n        display: block;\n    }","."+t.clone+"{\n        position: absolute;\n        top: 0; left: 0;\n        width: 100%; height: 100%;\n        -webkit-transform: translate(-2%, 0);\n                transform: translate(-2%, 0);\n    }"]};function g(t,e){e.forEach(function(e,n){t.insertRule(e,n)})}function w(t){var e=document.createElement("style");return document.head.appendChild(e),g(e.sheet,v(t)),e.setAttribute(m,""),e}function y(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=0,n=s("svg",{xmlns:i},i),l=s("defs",null,i);n.appendChild(l),document.body.appendChild(n);var r=w(t);return{classes:t,element:l,hashId:function(){return"gi-"+p("glitch"+e++,10)},options:function(e){if(null!=e){var n=0;Object.keys(e).forEach(function(i){t[i]&&e[i]!==t[i]&&(t[i]=e[i],n++)}),n>0&&(document.head.removeChild(r),r=w(t))}}}}var C=y({wrapper:"gi-wrapper",image:"gi-image",clone:"gi-clone"});function b(n){var i=[];t(n).forEach(function(t){e(t,function(){return i.push(new f(t,C))})});var l={destroy:function(){return i.forEach(function(t){return t.destroy()}),i=null,null},update:function(){if(null!=i)for(var t=-1,e=i.length;++t<e;)i[t].update();return l}};return l}b.options=C.options,module.exports=b;
