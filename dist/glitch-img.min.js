/*! Copyright (c) 2017 Bartosz Lorek. MIT license */

!function(t,i){"function"==typeof define&&define.amd?define([],i):t.GlitchImg=i()}(this,function(){var t,i,e;return function(n){function r(t,i){var e,n,r,s,l,o,c,h,u,a,f=i&&i.split("/"),p=d.map,g=p&&p["*"]||{};if(t&&"."===t.charAt(0)&&i){for(f=f.slice(0,f.length-1),t=f.concat(t.split("/")),h=0;a=t[h];h++)if("."===a)t.splice(h,1),h-=1;else if(".."===a){if(1===h&&(".."===t[2]||".."===t[0]))return!0;h>0&&(t.splice(h-1,2),h-=2)}t=t.join("/")}if((f||g)&&p){for(e=t.split("/"),h=e.length;h>0;h-=1){if(n=e.slice(0,h).join("/"),f)for(u=f.length;u>0;u-=1)if(r=p[f.slice(0,u).join("/")],r&&(r=r[n])){s=r,l=h;break}if(s)break;!o&&g&&g[n]&&(o=g[n],c=h)}!s&&o&&(s=o,l=c),s&&(e.splice(0,l,s),t=e.join("/"))}return t}function s(t,i){return function(){return f.apply(n,v.call(arguments,0).concat([t,i]))}}function l(t){return function(i){return r(i,t)}}function o(t){return function(i){p[t]=i}}function c(t){if(g.hasOwnProperty(t)){var i=g[t];delete g[t],m[t]=!0,a.apply(n,i)}if(!p.hasOwnProperty(t))throw new Error("No "+t);return p[t]}function h(t,i){var e,n,s=t.indexOf("!");return s!==-1?(e=r(t.slice(0,s),i),t=t.slice(s+1),n=c(e),t=n&&n.normalize?n.normalize(t,l(i)):r(t,i)):t=r(t,i),{f:e?e+"!"+t:t,n:t,p:n}}function u(t){return function(){return d&&d.config&&d.config[t]||{}}}var a,f,p={},g={},d={},m={},v=[].slice;a=function(t,i,e,r){var l,a,f,d,v,y,w=[];if(r=r||t,"function"==typeof e){for(i=!i.length&&e.length?["require","exports","module"]:i,y=0;y<i.length;y++)if(v=h(i[y],r),f=v.f,"require"===f)w[y]=s(t);else if("exports"===f)w[y]=p[t]={},l=!0;else if("module"===f)a=w[y]={id:t,uri:"",exports:p[t],config:u(t)};else if(p.hasOwnProperty(f)||g.hasOwnProperty(f))w[y]=c(f);else if(v.p)v.p.load(v.n,s(r,!0),o(f),{}),w[y]=p[f];else if(!m[f])throw new Error(t+" missing "+f);d=e.apply(p[t],w),t&&(a&&a.exports!==n&&a.exports!==p[t]?p[t]=a.exports:d===n&&l||(p[t]=d))}else t&&(p[t]=e)},t=i=f=function(t,i,e,r){return"string"==typeof t?c(h(t,i).f):(t.splice||(d=t,i.splice?(t=i,i=e,e=null):t=n),i=i||function(){},r?a(n,t,i,e):setTimeout(function(){a(n,t,i,e)},15),f)},f.config=function(t){return d=t,f},e=function(t,i,e){i.splice||(e=i,i=[]),g[t]=[t,i,e]},e.amd={jQuery:!0}}(),e("tools/almond",function(){}),e("GlitchImg",[],function(){function t(t,i){var e=Math.random()*(i||1);return Math.random()*(1-e)+t*e}function i(t){var i=[];return"string"==typeof t||"object"==typeof t&&null!==t?"string"==typeof t?("."===t[0]?(t=document.getElementsByClassName(t.slice(1)),t.length&&(i=Array.prototype.slice.call(t))):"#"===t[0]&&(t=document.getElementById(t.slice(1)),null!==t&&(i=[t])),i):t.nodeType?[t]:Array.prototype.slice.call(t):i}function e(t){var i={"ns:svg":"http://www.w3.org/2000/svg","ns:xlink":"http://www.w3.org/1999/xlink","ns:xmlns":"http://www.w3.org/2000/xmlns/"};return"string"==typeof t&&"ns:"===t.substring(0,3)&&(t=i[t]),t}function n(t,i,n){var r,s,l="undefined"==typeof n?document.createElement(t):document.createElementNS(e(n),t);for(r in i)s=i[r],s.constructor===Array?l.setAttributeNS(e(s[0]),r,e(s[1])):l.setAttribute(r,e(s));return l}function r(t){if(!t||!t.nodeType)return!1;for(;t.firstChild;)t.removeChild(t.firstChild)}function s(t){var i,e,r=document.getElementById("glitch-img-clips");null===r?(r=n("svg",{xmlns:"ns:svg",id:"glitch-img-clips"},"ns:svg"),e=n("defs",null,"ns:svg"),r.appendChild(e),document.body.appendChild(r)):e=r.childNodes[0];for(var s,l=0;l<e.childNodes.length;l++)if(s=e.childNodes[l],parseInt(s.id.split("-").pop())===t)return s;return i=n("clipPath",{id:"glitch-img-clip-"+t},"ns:svg"),e.appendChild(i),i}function l(t,i,e){var r,s,l;return t.className.indexOf("glitch-img-src")!==-1?(l=t.nextSibling.childNodes[0],l.setAttribute("clip-path","url(#glitch-img-clip-"+i+")"),l):(e=e&&" "+e||"",r=n("div",{class:"glitch-img-wrap"+e}),s=n("svg",{class:"glitch-img-svg",preserveAspectRatio:[null,"none"],"xmlns:xlink":["ns:xmlns","ns:xlink"]},"ns:svg"),l=n("image",{"xlink:href":["ns:xlink",t.src],"clip-path":"url(#glitch-img-clip-"+i+")",width:[null,"100%"],height:[null,"100%"]},"ns:svg"),s.appendChild(l),r.appendChild(s),t.className+=" glitch-img-src",t.parentNode.insertBefore(r,t),r.insertBefore(t,s),l)}function o(t){return this.clipId=c++,this.images=[],this.add(t),this}var c=0;return o.prototype={add:function(t){for(var e,n,r,s=i(t),o=this.images.length,c=0;c<s.length;c++)n=s[c],r=l(n,this.clipId),e=o+c,this.images[e]={img:n,imgSvg:r,width:0,height:0},function(t,i,e){var n=new Image;n.onload=function(){t.images[i].width=n.width,t.images[i].height=n.height,t.refresh(e)},n.src=e.src}(this,e,n);return this},remove:function(){},clip:function(){return"undefined"==typeof this.clipPath&&(this.clipPath=s(this.clipId),this.update()),this},refresh:function(t){var i,e,n=100,r=100;for(s=0;s<this.images.length;s++)if(this.images[s].img===t||"number"==typeof t&&t===s){i=[this.images[s]];break}"undefined"==typeof i&&(i=this.images);for(var s=0;s<i.length;s++)i[s].imgSvg.parentNode.setAttribute("viewBox","0 0 "+i[s].width+" "+i[s].height);for(var s=0;s<this.images.length;s++)e=this.images[s],n=Math.max(e.width,n),r=Math.max(e.height,r);return this.clipWidth=n,this.clipHeight=r,this.update(),this},update:function(){var i,e,s=this.clipWidth||100,l=this.clipHeight||100,o=.3*l,c=0;if(!this.images.length)return this;for(this.clip(),r(this.clipPath),e=document.createDocumentFragment();c<=l;)i=Math.round(t(.01)*o),c+=Math.round(t(.01)*o)+i,e.appendChild(n("rect",{x:[null,"0"],y:[null,c],height:[null,i],width:[null,s]},"ns:svg"));return this.clipPath.appendChild(e),this}},o}),i("GlitchImg")});