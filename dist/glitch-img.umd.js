!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.glitchImg=e()}(this,function(){"use strict";function t(t,e){if(null!=t&&null!=e)if(t.complete)e(t,t.naturalWidth,t.naturalHeight);else{var n=t.src||t;if("string"!=typeof n)return;var i=new Image;i.onload=function(){e(t,i.naturalWidth,i.naturalHeight)},i.src=n}}function e(t,e){var n=Math.random()*(e||1);return Math.random()*(1-n)+t*n}var n="http://www.w3.org/2000/svg",i="http://www.w3.org/1999/xlink",l="http://www.w3.org/2000/xmlns/";function r(t,e,n){var i=void 0!==n?document.createElementNS(n,t):document.createElement(t);if(null!=e){var l=void 0,r=void 0;for(l in e)r=e[l],Array.isArray(r)?i.setAttributeNS(r[0]||null,l,r[1]):i.setAttribute(l,r)}return i}var s=function(t){return"string"==typeof t?t.split(/\s+/):t||[]};function a(t,e){return t.classList?t.classList.contains(e):!!(t.className.indexOf(e)>-1)}function o(t,e){var n=s(e);if(t.classList)t.classList.add.apply(t.classList,n);else{for(var i=t.className,l=0;l<n.length;l++)i.indexOf(n[l])<0&&(i+=" "+n[l]);t.className=i}}function h(t,e){var n=s(e);if(t.classList)t.classList.remove.apply(t.classList,n);else{for(var i=s(t.className),l="",r=0;r<i.length;r++)n.indexOf(i[r])<0&&(l+=" "+i[r]);t.className=l.substring(1)}}function u(t){if(null==t)return null;for(;t.firstChild;)t.removeChild(t.firstChild);return t}function c(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=r("svg",{"xmlns:xlink":[l,i],preserveAspectRatio:[null,"none"],viewBox:"0 0 "+t.width+" "+t.height,class:t.class},n),s=r("image",{"clip-path":"url(#"+t.id+")",href:[i,t.src],width:[null,"100%"],height:[null,"100%"]},n);return e.appendChild(s),e}function d(t,e){if(!t||!t.src||a(t,e.classes.image))return this.element=null;var i=e.hashId();this.element=t,this.width=t.naturalWidth||100,this.height=t.naturalHeight||100,this.defs=e,o(t,e.classes.image);var l=r("div",{class:e.classes.wrapper}),s=c({src:t.src,width:this.width,height:this.height,class:e.classes.clone,id:i});t.parentElement.insertBefore(l,t),l.appendChild(t),l.appendChild(s),this.clipPath=r("clipPath",{id:i},n),e.element.appendChild(this.clipPath),this.update()}function f(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:8,n=arguments[2],i=null!=t?t.length:0,l="number"==typeof n?n:Date.now(),r="",s=1,a=0;a<i;a++)l^=t.charCodeAt(a),l+=(l<<1)+(l<<4)+(l<<7)+(l<<8)+(l<<24);for(l>>>=0;r.length<e;)r+=(l*s++).toString(16);return r.substr(0,e)}d.prototype={destroy:function(){if(null!=this.element){h(this.element,this.defs.classes.image);var t=this.element.parentElement;t.parentElement.insertBefore(this.element,t),t.parentElement.removeChild(t),this.defs.element.removeChild(this.clipPath),this.element=null,this.clipPath=null,this.defs=null}return null},update:function(){if(null==this.element)return this;var t=.3*this.height,i=0,l=void 0,s=void 0;for(u(this.clipPath),s=document.createDocumentFragment();i<=this.height;)l=Math.round(e(.01)*t),i+=Math.round(e(.01)*t)+l,s.appendChild(r("rect",{x:[null,"0"],y:[null,i],height:[null,l],width:[null,this.width]},n));return this.clipPath.appendChild(s),this}};var p="data-glitch-img",m=function(t){return["."+t.wrapper+"{\n        position: relative;\n        overflow: hidden;\n        display: inline-block;\n        vertical-align: top;\n    }","."+t.image+"{\n        display: block;\n    }","."+t.clone+"{\n        position: absolute;\n        top: 0; left: 0;\n        width: 100%; height: 100%;\n        -webkit-transform: translate(-2%, 0);\n                transform: translate(-2%, 0);\n    }"]};function g(t){var e,n=document.createElement("style");return document.head.appendChild(n),e=n.sheet,m(t).forEach(function(t,n){e.insertRule(t,n)}),n.setAttribute(p,""),n}var v=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=0,i=r("svg",{xmlns:n},n),l=r("defs",null,n);i.appendChild(l),document.body.appendChild(i);var s=g(t);return{classes:t,element:l,hashId:function(){return"gi-"+f("glitch"+e++,10)},options:function(e){if(null!=e){var n=0;Object.keys(e).forEach(function(i){t[i]&&e[i]!==t[i]&&(t[i]=e[i],n++)}),n>0&&(document.head.removeChild(s),s=g(t))}}}}({wrapper:"gi-wrapper",image:"gi-image",clone:"gi-clone"});function w(e){var n,i=[];(n=e,null==n?[]:void 0!==n.length?Array.prototype.slice.call(n):[n]).forEach(function(e){t(e,function(){return i.push(new d(e,v))})});var l={destroy:function(){return i.forEach(function(t){return t.destroy()}),i=null,null},update:function(){if(null!=i)for(var t=-1,e=i.length;++t<e;)i[t].update();return l}};return l}return w.options=v.options,w});
